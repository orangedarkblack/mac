name: macOS AnyDesk con Pantalla Virtual
on: workflow_dispatch

jobs:
  anydesk-session:
    runs-on: macos-latest
    steps:
      - name: Instalar Herramientas de Pantalla
        run: |
          brew install displayplacer
          # Forzamos una resolución estándar para activar el frame buffer
          displayplacer "res:1280x720 hz:60 color_depth:8" || true

      - name: Instalar AnyDesk vía Homebrew (Método Seguro)
        run: |
          # Usamos brew pero con sudo para asegurar la carpeta de Aplicaciones
          sudo brew install --cask anydesk --no-quarantine

      - name: Configurar Acceso Desatendido
        run: |
          # Seteamos la contraseña (usa tu secreto USER_PASS)
          echo "${{ secrets.USER_PASS }}" | sudo /Applications/AnyDesk.app/Contents/MacOS/AnyDesk --set-password
          
          # Iniciamos el proceso en segundo plano para que genere el ID
          /Applications/AnyDesk.app/Contents/MacOS/AnyDesk &
          sleep 15
          
          echo "------------------------------------------"
          echo "TU ID DE ANYDESK ES:"
          /Applications/AnyDesk.app/Contents/MacOS/AnyDesk --get-id
          echo "CONTRASEÑA: La de tu secreto USER_PASS"
          echo "------------------------------------------"

      - name: Mantener sesión activa
        run: sleep 21600
