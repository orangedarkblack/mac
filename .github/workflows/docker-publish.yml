name: macOS VNC Desktop
on: workflow_dispatch # Permite activarlo manualmente

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Crear usuario administrador
        run: |
          sudo sysadminctl -addUser vncuser -fullName "VNC User" -password "${{ secrets.USER_PASS }}" -admin

      - name: Activar Remote Management (Screen Sharing)
        run: |
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
          -activate -configure -access -on \
          -allowAccessFor -allUsers -privs -all -restart -agent

      - name: Iniciar túnel con Serveo
        run: |
          # Abre un túnel del puerto local 5900 al puerto 80 de serveo.net
          # -o StrictHostKeyChecking=no evita que el runner se detenga pidiendo confirmar el host
          ssh -o StrictHostKeyChecking=no -R 80:localhost:5900 serveo.net &
          sleep 5

      - name: Mantener activo y mostrar logs
        run: |
          echo "Conéctate a la dirección que aparezca abajo usando tu cliente VNC:"
          echo "Usuario: vncuser"
          echo "Password: ${{ secrets.USER_PASS }}"
          # Mantenemos el proceso vivo y mostramos si hay errores en la conexión SSH
          tail -f /dev/null 

